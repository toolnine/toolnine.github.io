<!-- START OF FILE: tools/calculator.html (Upgraded) -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- SEO OPTIMIZATION -->
  <title>Advanced Calculator | Basic, Scientific & Programmer Modes | ToolNine</title>
  <meta name="description" content="A user-friendly, feature-rich calculator for basic, scientific, and programmer calculations. Memory and calculation history included. Fast, in-browser processing." />
  <!-- END SEO OPTIMIZATION -->

  <!-- Updated to root-relative path -->
  <link rel="stylesheet" href="/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <style>
    /* ---------- Calculator specific styles (keeps site look intact) ---------- */
    .tool-page { display:flex; flex-direction:column; align-items:center; justify-content:flex-start; padding-top:2rem; flex-grow:1; width:100%; }
    .tool-card { max-width:980px; padding:1.5rem; width:100%; box-shadow:0 10px 25px -5px rgba(0,0,0,0.05); background:var(--card); border-radius:12px; border:1px solid var(--border-color); }
    .tool-header { text-align:center; margin-bottom:1rem; }
    .tool-header h1 { font-size:1.8rem; color:var(--accent); font-weight:700; }
    .tool-desc { color: #475569; max-width: 650px; margin: 0 auto; line-height: 1.5; font-size: 1rem; }
    [data-theme="dark"] .tool-desc { color: #94a3b8; }

    .mode-tabs { display:flex; gap:0.5rem; justify-content:center; margin-bottom:1rem; }
    .mode-tab { padding:0.5rem 0.9rem; border-radius:8px; cursor:pointer; font-weight:600; border:1px solid transparent; background:var(--card); }
    .mode-tab:hover { background: var(--border-color); }
    .mode-tab.active { background:var(--accent); color:white; border-color:var(--accent); }
    [data-theme="dark"] .mode-tab.active { background:var(--accent); border-color:var(--accent); }

    .calc-top { display:flex; gap:1rem; align-items:flex-start; flex-wrap:wrap; }
    .calc-left { flex:1 1 420px; min-width:320px; }
    .calc-right { width:280px; min-width:240px; max-height:420px; overflow:auto; }

    #calculatorDisplay { background:var(--bg); border:1px solid var(--border-color); border-radius:10px; padding:18px; font-size:1.6rem; text-align:right; color:var(--text); min-height:72px; word-wrap:break-word; display:flex; flex-direction:column; justify-content:center; position: relative; }
    #calcExpression { font-size:0.9rem; color:#64748b; text-align:right; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    #calcResult { font-size:1.4rem; font-weight:700; margin-top:6px; word-break:break-all; }
    [data-theme="dark"] #calcExpression { color: #94a3b8; }

    /* Keypad Layout */
    .keypad { margin-top:12px; display:grid; gap:8px; }
    .btn { padding:12px; border-radius:8px; border:1px solid var(--border-color); background:var(--card); color:var(--text); font-weight:600; cursor:pointer; transition:0.12s; }
    .btn:hover { background-color: #f1f5f9; }
    [data-theme="dark"] .btn:hover { background-color: #475569; }

    .keypad-basic { grid-template-columns: repeat(6, 1fr); }
    .keypad-scientific { grid-template-columns: repeat(6, 1fr); }
    .keypad-programmer { grid-template-columns: repeat(6, 1fr); }

    /* Button specific colors/styles */
    .btn-operator { background:var(--accent); color:white; border-color:var(--accent); }
    .btn-operator:hover { background-color: #1e40af; }
    [data-theme="dark"] .btn-operator:hover { background-color: #2563eb; }

    .btn-equal { grid-column: span 2; background:#16a34a; color:white; border-color:#16a34a; }
    .btn-equal:hover { background-color:#15803d; }
    [data-theme="dark"] .btn-equal { background:#15803d; border-color:#15803d; }
    [data-theme="dark"] .btn-equal:hover { background-color:#16a34a; }

    .btn-clear { background:#ef4444; color:white; border-color:#ef4444; }
    .btn-clear:hover { background-color:#dc2626; }
    [data-theme="dark"] .btn-clear { background:#dc2626; border-color:#dc2626; }
    [data-theme="dark"] .btn-clear:hover { background-color:#ef4444; }

    .btn-wide { grid-column: span 2; }

    /* History and Memory Styles */
    .history { padding:12px; border-radius:10px; border:1px solid var(--border-color); background:var(--bg); }
    .history h3 { margin:0 0 8px 0; font-size:1rem; color: var(--text); }
    .history-list { max-height:320px; overflow:auto; display:flex; flex-direction:column; gap:8px; }
    .history-entry { font-size:0.95rem; padding:6px 8px; border-radius:6px; background:transparent; border:1px dashed var(--border-color); cursor:pointer; }
    .history-entry:hover { background: #f1f5f9; }
    [data-theme="dark"] .history-entry:hover { background: #475569; }

    .mem-display { font-size:0.9rem; color:#64748b; margin-bottom:8px; }
    [data-theme="dark"] .mem-display { color: #94a3b8; }
    .mem-controls { display:flex; gap:6px; margin-bottom:8px;}
    .mem-btn { font-size:0.9rem; padding:6px 8px; border-radius:6px; }

    /* Responsive adjustments */
    @media (max-width:860px) {
      .calc-top { flex-direction:column-reverse; }
      .calc-right { width:100%; }
      .keypad-basic { grid-template-columns: repeat(4, 1fr); }
      .keypad-scientific { grid-template-columns: repeat(4, 1fr); }
      .keypad-programmer { grid-template-columns: repeat(4, 1fr); }
      .btn-equal { grid-column: span 2; }
    }
  </style>
</head>
<body>

    <!-- 1. Header Placeholder -->
    <div id="header-placeholder"></div>

  <!-- ===== MAIN (Calculator) ===== -->
  <main class="content tool-page">
    <section class="tool-card">
      <header class="tool-header">
        <h1>ðŸ§® Calculator</h1>
        <p class="tool-desc">Choose mode and calculate â€” Basic, Scientific, or Programmer. Memory & History included.</p>
      </header>

      <!-- Mode Tabs -->
      <div class="mode-tabs" role="tablist" aria-label="Calculator modes">
        <button class="mode-tab active" data-mode="basic">Basic</button>
        <button class="mode-tab" data-mode="scientific">Scientific</button>
        <button class="mode-tab" data-mode="programmer">Programmer</button>
      </div>

      <div class="calc-top">
        <!-- Left: Display + keypad -->
        <div class="calc-left">
          <div id="calculatorDisplay" aria-live="polite">
            <div id="calcExpression"> </div>
            <div id="calcResult">0</div>
          </div>

          <!-- Keypads: one container, inside multiple grids hidden/shown by JS -->
          <div id="keypadContainer">
            <!-- BASIC KEYPAD -->
            <div class="keypad keypad-basic" data-mode="basic">
              <button class="btn btn-clear">C</button>
              <button class="btn" data-op="backspace">âŒ«</button>
              <button class="btn" data-op="(">(</button>
              <button class="btn" data-op=")">)</button>
              <button class="btn" data-op="%">%</button>
              <button class="btn btn-operator" data-op="/">Ã·</button>

              <button class="btn" data-value="7">7</button>
              <button class="btn" data-value="8">8</button>
              <button class="btn" data-value="9">9</button>
              <button class="btn btn-operator" data-op="*">Ã—</button>
              <button class="btn" data-op="toggle_sign">Â±</button>
              <button class="btn" data-op="sqrt">âˆš</button>

              <button class="btn" data-value="4">4</button>
              <button class="btn" data-value="5">5</button>
              <button class="btn" data-value="6">6</button>
              <button class="btn btn-operator" data-op="-">âˆ’</button>
              <button class="btn" data-op="M+">M+</button>
              <button class="btn" data-op="M-">M-</button>

              <button class="btn" data-value="1">1</button>
              <button class="btn" data-value="2">2</button>
              <button class="btn" data-value="3">3</button>
              <button class="btn btn-operator" data-op="+">+</button>
              <button class="btn" data-op="MR">MR</button>
              <button class="btn" data-op="MC">MC</button>

              <button class="btn" data-value="0">0</button>
              <button class="btn" data-value=".">.</button>
              <button class="btn btn-equal" data-op="=">=</button>
              <button class="btn btn-wide" data-op="ans">Ans</button>
            </div>

            <!-- SCIENTIFIC KEYPAD -->
            <div class="keypad keypad-scientific" data-mode="scientific" style="display:none;">
              <button class="btn btn-clear">C</button>
              <button class="btn" data-op="backspace">âŒ«</button>
              <button class="btn" data-op="(">(</button>
              <button class="btn" data-op=")">)</button>
              <button class="btn" data-op="%">%</button>
              <button class="btn btn-operator" data-op="/">Ã·</button>

              <button class="btn" data-op="sin">sin</button>
              <button class="btn" data-op="cos">cos</button>
              <button class="btn" data-op="tan">tan</button>
              <button class="btn" data-op="sqrt">âˆš</button>
              <button class="btn" data-op="^">xÊ¸</button>
              <button class="btn btn-operator" data-op="*">Ã—</button>

              <button class="btn" data-value="7">7</button>
              <button class="btn" data-value="8">8</button>
              <button class="btn" data-value="9">9</button>
              <button class="btn" data-op="log">log</button>
              <button class="btn" data-op="ln">ln</button>
              <button class="btn btn-operator" data-op="-">âˆ’</button>

              <button class="btn" data-value="4">4</button>
              <button class="btn" data-value="5">5</button>
              <button class="btn" data-value="6">6</button>
              <button class="btn" data-op="x2">xÂ²</button>
              <button class="btn" data-op="x3">xÂ³</button>
              <button class="btn" data-op="M+">M+</button>

              <button class="btn" data-value="1">1</button>
              <button class="btn" data-value="2">2</button>
              <button class="btn" data-value="3">3</button>
              <button class="btn" data-op="pi">Ï€</button>
              <button class="btn" data-op="e">e</button>
              <button class="btn" data-op="M-">M-</button>

              <button class="btn" data-value="0">0</button>
              <button class="btn" data-value=".">.</button>
              <button class="btn btn-equal" data-op="=">=</button>
              <button class="btn btn-wide" data-op="ans">Ans</button>
            </div>

            <!-- PROGRAMMER KEYPAD (UI Improvement) -->
            <div class="keypad keypad-programmer" data-mode="programmer" style="display:none;">
              <button class="btn btn-clear">C</button>
              <button class="btn" data-op="backspace">âŒ«</button>
              <button class="btn" data-op="(">(</button>
              <button class="btn" data-op=")">)</button>
              <button class="btn" data-op="%">%</button>
              <button class="btn btn-operator" data-op="/">Ã·</button>

              <button class="btn" data-op="AND">AND</button>
              <button class="btn" data-op="OR">OR</button>
              <button class="btn" data-op="XOR">XOR</button>
              <button class="btn" data-op="NOT">NOT</button>
              <button class="btn" data-op="<<"><<</button>
              <button class="btn" data-op=">>">>></button>

              <!-- Number/Hex inputs -->
              <button class="btn" data-value="7">7</button>
              <button class="btn" data-value="8">8</button>
              <button class="btn" data-value="9">9</button>
              <button class="btn" data-op="A">A</button>
              <button class="btn" data-op="B">B</button>
              <button class="btn" data-op="C">C</button>

              <button class="btn" data-value="4">4</button>
              <button class="btn" data-value="5">5</button>
              <button class="btn" data-value="6">6</button>
              <button class="btn" data-op="D">D</button>
              <button class="btn" data-op="E">E</button>
              <button class="btn" data-op="F">F</button>

              <button class="btn" data-value="1">1</button>
              <button class="btn" data-value="2">2</button>
              <button class="btn" data-value="3">3</button>
              <button class="btn btn-operator" data-op="+">+</button>
              <button class="btn btn-operator" data-op="-">âˆ’</button>
              <button class="btn btn-operator" data-op="*">Ã—</button>

              <button class="btn" data-value="0">0</button>
              <button class="btn" data-value=".">.</button>
              <button class="btn btn-equal" data-op="=">=</button>
              <button class="btn btn-wide" data-op="ans">Ans</button>
            </div>
          </div>
        </div>

        <!-- Right: Memory + History -->
        <aside class="calc-right">
          <div class="history">
            <div class="mem-display">Memory: <span id="memValue">0</span></div>
            <div class="mem-controls">
              <button class="btn small mem-btn" id="memMC">MC</button>
              <button class="btn small mem-btn" id="memMR">MR</button>
              <button class="btn small mem-btn" id="memMplus">M+</button>
              <button class="btn small mem-btn" id="memMminus">M-</button>
            </div>

            <h3>History</h3>
            <div class="history-list" id="historyList" aria-live="polite"></div>
            <div style="margin-top:8px; display:flex; gap:8px;">
              <button class="btn small" id="clearHistory">Clear History</button>
              <button class="btn small" id="exportHistory">Export History</button>
            </div>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <!-- PWA Install Button (unchanged) -->
  <div class="pwa-install-container">
    <button class="btn" id="installButton" style="display:none;">Install App</button>
  </div>

    <!-- 2. Footer Placeholder -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <!-- NEW: Load the component loader script first -->
    <script src="/js/load-components.js"></script>
    <!-- Keep existing scripts here -->
    <script src="/theme.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Elements
      const tabs = document.querySelectorAll('.mode-tab');
      const keypads = document.querySelectorAll('[data-mode]');
      const expressionEl = document.getElementById('calcExpression');
      const resultEl = document.getElementById('calcResult');
      const historyListEl = document.getElementById('historyList');
      const memValueEl = document.getElementById('memValue');

      // State
      let mode = 'basic';                 // basic | scientific | programmer
      let expr = '';                      // expression shown
      let ans = null;                     // last answer
      let memory = 0;                     // memory slot (number)
      let history = [];                   // {expr, result, mode}
      let programmerBase = 'DEC';         // active base for programmer mode display

      // Helpers
      function setMode(m) {
        mode = m;
        tabs.forEach(t => t.classList.toggle('active', t.dataset.mode === m));
        keypads.forEach(k => {
          if (k.dataset.mode === m) k.style.display = 'grid'; // Use 'grid' here
          else k.style.display = 'none';
        });
        clearTempDisplay();
        render();
      }

      function clearTempDisplay() {
        expr = '';
        render();
      }

      function render() {
        expressionEl.textContent = expr || ' ';
        // Render result according to programmer base if in programmer mode
        if (mode === 'programmer') {
          try {
            const resultValue = evalProgrammer(expr || '0');
            resultEl.textContent = formatProgrammerResult(resultValue, programmerBase);
          } catch {
            resultEl.textContent = 'Error';
          }
        } else {
          resultEl.textContent = (ans === null ? '0' : String(ans));
        }
        memValueEl.textContent = String(memory);
      }

      // Format programmer mode result for display
      function formatProgrammerResult(value, base) {
        if (isNaN(value)) return 'Error';
        const intValue = Math.trunc(value);
        switch (base) {
          case 'HEX': return '0x' + intValue.toString(16).toUpperCase();
          case 'BIN': return '0b' + intValue.toString(2);
          case 'DEC': return String(intValue);
          default: return String(intValue);
        }
      }

      function pushHistory(entry) {
        history.unshift(entry);
        if (history.length > 200) history.pop();
        renderHistory();
      }

      function renderHistory() {
        historyListEl.innerHTML = '';
        history.forEach((h) => {
          const div = document.createElement('div');
          div.className = 'history-entry';
          div.textContent = `${h.mode.toUpperCase()}: ${h.expr} = ${h.result}`;
          div.title = 'Click to reuse';
          div.addEventListener('click', () => {
            expr = h.expr;
            ans = h.result;
            render();
          });
          historyListEl.appendChild(div);
        });
      }

      // Evaluate expression safely-ish:
      function safeEval(input, modeForEval) {
        if (!input) return 0;
        try {
          // Preprocess percentage: turn '50%' -> '(50/100)'
          input = input.replace(/(\d+(\.\d+)?)%/g, '($1/100)');
          // Replace unicode operator chars
          input = input.replace(/Ã—/g, '*').replace(/Ã·/g, '/');
          // ^ to **
          input = input.replace(/\^/g, '**');
          // Replace trig/log functions to Math.
          input = input.replace(/\bsin\(/g, 'Math.sin(');
          input = input.replace(/\bcos\(/g, 'Math.cos(');
          input = input.replace(/\btan\(/g, 'Math.tan(');
          input = input.replace(/\blog\(/g, 'Math.log10(');
          input = input.replace(/\bln\(/g, 'Math.log(');
          input = input.replace(/\bsqrt\(/g, 'Math.sqrt(');
          input = input.replace(/\babs\(/g, 'Math.abs(');
          input = input.replace(/\bpi\b/g, String(Math.PI));
          input = input.replace(/\be\b/g, String(Math.E));
          // Replace xÂ² and xÂ³ patterns like "5 x2" or "5 xÂ²"
          input = input.replace(/\b(\d+(\.\d+)?)\s*x2\b/g, '($1**2)');
          input = input.replace(/\b(\d+(\.\d+)?)\s*x3\b/g, '($1**3)');

          // Evaluate using Function to sandbox a bit:
          const fn = new Function('return (' + input + ')');
          let res = fn();

          if (!isFinite(res) || Number.isNaN(res)) throw new Error('Math Error');
          if (Math.abs(res) < 1e-12) res = 0;
          if (typeof res === 'number') {
            res = Math.round((res + Number.EPSILON) * 1e12) / 1e12;
          }
          return res;
        } catch (e) {
          throw new Error('Error');
        }
      }

      // Programmer mode evaluate (Fixed Logic)
      function evalProgrammer(input) {
        try {
          // 1. Convert HEX to decimal for evaluation
          input = input.replace(/0x([0-9a-fA-F]+)/g, (match, hex) => parseInt(hex, 16));
          // 2. Normalize spaces
          input = input.replace(/\s+/g, ' ').trim();

          // 3. Replace text operators with bitwise JS operators
          let s = input.replace(/\bAND\b/gi, '&');
          s = s.replace(/\bOR\b/gi, '|');
          s = s.replace(/\bXOR\b/gi, '^');
          s = s.replace(/\bNOT\b/gi, '~');

          // 4. Evaluate using Function (safer sandbox approach)
          const fn = new Function('return (' + s + ')');
          let res = fn();

          if (!Number.isFinite(res) || Number.isNaN(res)) throw new Error('Math Error');
          res = Math.trunc(res); // Ensure integer result for programmer logic

          return res;
        } catch (e) {
          throw new Error('Error');
        }
      }

      // Button handlers
      function onBtnClick(btn) {
        const value = btn.dataset.value;
        const op = btn.dataset.op;

        if (value !== undefined) {
          if (value === '.') {
            const tokens = expr.split(/[\s+\-*/%^()]+/).filter(Boolean);
            const last = tokens[tokens.length - 1] || '';
            if (last.includes('.')) return;
          }
          expr += value;
          render();
          return;
        }

        if (!op) return;

        switch (op) {
          case 'backspace':
            expr = expr.slice(0, -1);
            if (expr === '') expr = '';
            render();
            break;
          case 'C':
            expr = '';
            ans = null;
            render();
            break;
          case 'toggle_sign':
            // Naive approach for sign toggle, can be improved for scientific mode.
            // expr = expr.replace(/(-?\d+(\.\d+)?)(?!.*(-?\d+(\.\d+)?))/,'(' + '(-1*' + '$1' + '))');
            // A safer method for Basic mode: if result is displayed, toggle sign of result.
            // If text in input, toggle sign of last number.
            if (expr === '') {
                ans = ans !== null ? ans * -1 : 0;
            } else {
                expr = expr.replace(/(\d+(\.\d+)?)(?!.*[\d\.])/, (match) => `(-${match})`);
            }
            render();
            break;
          case 'pi':
          case 'e':
            expr += (op === 'pi' ? 'pi' : 'e');
            render();
            break;
          case 'x2':
          case 'x3':
            expr += (op === 'x2' ? 'xÂ²' : 'xÂ³');
            render();
            break;
          case 'sin':
          case 'cos':
          case 'tan':
          case 'log':
          case 'ln':
          case 'sqrt':
            expr += op + '(';
            render();
            break;
          case '%':
            expr += '%';
            render();
            break;
          case 'M+':
            try {
              const val = computeCurrent();
              memory = (Number(memory) || 0) + Number(val || 0);
              memValueEl.textContent = String(memory);
            } catch(e) { /* ignore on error */ }
            break;
          case 'M-':
            try {
              const val = computeCurrent();
              memory = (Number(memory) || 0) - Number(val || 0);
              memValueEl.textContent = String(memory);
            } catch(e) { /* ignore on error */ }
            break;
          case 'MR':
            expr += String(memory);
            render();
            break;
          case 'MC':
            memory = 0;
            memValueEl.textContent = String(memory);
            break;
          case 'ans':
            if (ans !== null) expr += String(ans);
            render();
            break;
          case 'HEX':
          case 'BIN':
          case 'DEC':
            programmerBase = op;
            // Re-render display according to base change
            if (mode === 'programmer') render();
            break;
          case 'AND':
          case 'OR':
          case 'XOR':
          case 'NOT':
          case '<<':
          case '>>':
            expr += ' ' + op + ' ';
            render();
            break;
          case 'A': case 'B': case 'C': case 'D': case 'E': case 'F':
            expr += op;
            render();
            break;
          case '=':
            try {
              const res = computeAndRecord();
              ans = res;
              render();
            } catch (e) {
              ans = 'Error';
              render();
            }
            break;
          case '+': case '-': case '*': case '/': case '^':
            expr += ' ' + op + ' ';
            render();
            break;
          default:
            expr += op;
            render();
        }
      }

      // computeCurrent: quick try to evaluate current expr, used for memory ops
      function computeCurrent() {
        if (!expr) return 0;
        if (mode === 'programmer') {
          return evalProgrammer(expr);
        } else {
          return safeEval(expr, mode);
        }
      }

      // computeAndRecord: evaluate, push to history, return result
      function computeAndRecord() {
        if (!expr) throw new Error('Empty');
        let res;
        if (mode === 'programmer') {
          res = evalProgrammer(expr);
        } else {
          res = safeEval(expr, mode);
        }
        pushHistory({ expr: expr, result: res, mode });
        expr = String(res);
        return res;
      }

      // Attach event listeners to keypad buttons
      document.querySelectorAll('.keypad .btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          onBtnClick(btn);
        });
      });

      // Tabs
      tabs.forEach(t => {
        t.addEventListener('click', () => setMode(t.dataset.mode));
      });

      // Memory buttons on right
      document.getElementById('memMC').addEventListener('click', () => { memory = 0; memValueEl.textContent = memory; });
      document.getElementById('memMR').addEventListener('click', () => { expr += String(memory); render(); });
      document.getElementById('memMplus').addEventListener('click', () => { try { memory += computeCurrent(); memValueEl.textContent = memory; } catch{} });
      document.getElementById('memMminus').addEventListener('click', () => { try { memory -= computeCurrent(); memValueEl.textContent = memory; } catch{} });

      // History controls
      document.getElementById('clearHistory').addEventListener('click', () => { history = []; renderHistory(); });
      document.getElementById('exportHistory').addEventListener('click', () => {
        if (!history.length) return alert('No history to export');
        const text = history.map(h => `${h.mode.toUpperCase()}: ${h.expr} = ${h.result}`).join('\n');
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'calculator_history.txt';
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      });

      // Keyboard support
      document.addEventListener('keydown', (e) => {
        const key = e.key;
        const targetElement = e.target.tagName; // Prevents interference if user is typing elsewhere

        if (targetElement === 'INPUT' || targetElement === 'TEXTAREA') {
            return;
        }

        if ((key >= '0' && key <= '9') || key === '.') {
          expr += key; render(); return;
        }
        if (key === '+' || key === '-' || key === '*' || key === '/') {
          expr += ' ' + key + ' '; render(); return;
        }
        if (key === 'Enter' || key === '=') {
          try { ans = computeAndRecord(); render(); } catch { ans = 'Error'; render(); }
          return;
        }
        if (key === 'Backspace') {
          e.preventDefault(); // Prevent navigating back in browser history
          expr = expr.slice(0, -1); render(); return;
        }
        if (key === 'Escape') {
          e.preventDefault(); // Prevent browser close/exit
          expr = ''; ans = null; render(); return;
        }
        // switch tabs by 1/2/3 (using number keys on keyboard)
        if (key === '1') { setMode('basic'); return; }
        if (key === '2') { setMode('scientific'); return; }
        if (key === '3') { setMode('programmer'); return; }
      });

      // initial render
      setMode('basic');
      render();
    });
  </script>
</body>
</html>
