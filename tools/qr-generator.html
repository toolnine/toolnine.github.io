<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO OPTIMIZATION -->
    <title>Advanced QR Code Generator | Bulk Barcode Creator | ToolNine</title>
    <meta name="description" content="Generate QR codes or barcodes from text or bulk data (CSV/Excel). Customize size, color, and export to PDF, Word, or PNG. Privacy-first client-side tool." />
    <!-- END SEO OPTIMIZATION -->
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
    <!-- Include QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Include Barcode Library (JsBarcode) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.6/JsBarcode.all.min.js"></script>
    <!-- Include jspdf for bulk PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Tool-specific styles based on the common layout */
        .tool-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 2rem;
            flex-grow: 1;
            width: 100%;
        }
        .tool-page .tool-card {
            max-width: 800px; /* Wider card for multiple controls */
            padding: 2rem;
            width: 100%;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        .tool-header { text-align: center; margin-bottom: 1.5rem; }
        .tool-header h1 { font-size: 2rem; color: var(--accent); font-weight: 700; }
        .tool-header .tool-desc { font-size: 1rem; color: #475569; max-width: 650px; margin: 0 auto; line-height: 1.5; }
        [data-theme="dark"] .tool-header .tool-desc { color: #94a3b8; }

        /* --- Custom UI for QR Generator --- */
        .qr-layout { display: flex; gap: 2rem; flex-wrap: wrap; justify-content: center; }
        .qr-controls { flex-basis: 300px; flex-shrink: 0; display: flex; flex-direction: column; gap: 1rem; }
        .qr-output-area { flex-grow: 1; min-width: 300px; text-align: center; }

        .qr-input-container textarea { min-height: 100px; }

        /* Bulk Upload Section */
        #bulkUploadSection { margin-top: 1rem; }
        .bulk-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .file-upload-options { display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem; }

        /* Output options section */
        #outputOptions { margin-top: 1rem; }
        #outputOptions label { display: block; margin-bottom: 0.25rem; font-weight: 500; }
        #outputOptions input, #outputOptions select { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg); color: var(--text); }

        #qrcode, #barcodeSvg {
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: inline-block;
            background: white; /* QR codes work best on white background */
        }
        #barcodeSvg { height: 100px; width: 256px; }

        /* Result Actions */
        .qr-output-actions { margin-top: 1rem; display: flex; gap: 1rem; justify-content: center; }

        /* How To Section styles (inherited from style.css) */
        .how-to { max-width: 700px; margin-top: 2rem; }

        /* Mobile adjustments */
        @media (max-width: 600px) {
            .qr-layout { flex-direction: column; }
            .qr-controls { flex-basis: 100%; }
        }
    </style>
</head>
<body>

    <header class="main-header">
        <a href="../index.html" class="logo">ToolNine</a>
        <button class="hamburger-btn" id="hamburgerBtn">‚ò∞</button>
        <nav class="main-nav">
            <ul>
                <li><a href="../index.html#category-image">Image Tools</a></li>
                <li><a href="../index.html#category-text">Text Tools</a></li>
                <li><a href="../blog.html">Blog</a></li>
            </ul>
            <button class="search-btn" id="searchBtn" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button>
            <button class="all-tools-btn" id="allToolsBtn">All Tools <span class="arrow">‚ñº</span></button>
            <button id="theme-toggle" class="theme-btn" aria-label="Toggle dark mode">üåô</button>
        </nav>
    </header>

    <div class="mega-menu" id="allToolsMenu">
        <!-- Mega menu content (full menu) -->
        <div class="mega-menu-grid">
            <div class="mega-menu-category">
                <h3>Image Tools</h3>
                <ul>
                    <li><a href="image-to-pdf.html"><span class="tool-icon">üìÑ</span> Image to PDF</a></li>
                    <li><a href="image-compressor.html"><span class="tool-icon">üóúÔ∏è</span> Image Compressor</a></li>
                    <li><a href="image-resizer.html"><span class="tool-icon">üìè</span> Image Resizer</a></li>
                    <li><a href="convert-png-jpg.html"><span class="tool-icon">üñºÔ∏è</span> PNG <> JPG</a></li>
                    <li><a href="steganography.html"><span class="tool-icon">üïµÔ∏è</span> Steganography</a></li>
                </ul>
            </div>
            <div class="mega-menu-category">
                <h3>Text & Writing</h3>
                <ul>
                    <li><a href="text-diff.html"><span class="tool-icon">üîç</span> Text Diff</a></li>
                    <li><a href="text-encryptor.html"><span class="tool-icon">üîê</span> Text Encryptor</a></li>
                    <li><a href="text-to-pdf.html"><span class="tool-icon">üìÑ</span> Text to PDF</a></li>
                    <li><a href="word-counter.html"><span class="tool-icon">‚úèÔ∏è</span> Word Counter</a></li>
                    <li><a href="line-operations.html"><span class="tool-icon">üî†</span> Line Operations</a></li>
                    <li><a href="text-cleaner.html"><span class="tool-icon">üßπ</span> Text Cleaner</a></li>
                    <li><a href="delivery-note-generator.html"><span class="tool-icon">üìù</span> Delivery Note Generator</a></li>
                </ul>
            </div>
            <div class="mega-menu-category">
                <h3>Converters</h3>
                <ul>
                    <li><a href="unit-converter.html"><span class="tool-icon">‚öñÔ∏è</span> Unit Converter</a></li>
                    <li><a href="document-scanner.html"><span class="tool-icon">üìë</span> Document Scanner</a></li>
                    <li><a href="csv-editor.html"><span class="tool-icon">üìä</span> CSV Editor</a></li>
                    <li><a href="calculator.html"><span class="tool-icon">üßÆ</span> Calculator</a></li>
                    <li><a href="pdf-editor.html"><span class="tool-icon">‚úçÔ∏è</span> PDF Editor</a></li> <!-- New Tool Added -->
                </ul>
            </div>
            <div class="mega-menu-category">
                <h3>Encoder/Decoder</h3>
                <ul>
                    <li><a href="url-encoder.html"><span class="tool-icon">üîó</span> URL Encoder</a></li>
                    <li><a href="hash-generator.html"><span class="tool-icon">üõ°Ô∏è</span> Hash Generator</a></li>
                    <li><a href="password-manager.html"><span class="tool-icon">üîë</span> Password Manager</a></li>
                    <li><a href="password-generator.html"><span class="tool-icon">üîë</span> Password Generator</a></li>
                    <li><a href="qr-generator.html"><span class="tool-icon">üì±</span> QR Generator</a></li>
                    <li><a href="pwa-manifest-generator.html"><span class="tool-icon">‚öôÔ∏è</span> PWA Manifest Generator</a></li>
                </ul>
            </div>
             <div class="mega-menu-category">
                <h3>AI Tools</h3>
                <ul>
                    <li><a href="image-to-prompt.html"><span class="tool-icon">ü§ñ</span> Image to Prompt</a></li>
                    <li><a href="json-formatter.html"><span class="tool-icon">üß©</span> JSON Formatter</a></li>
                    <li><a href="html-viewer.html"><span class="tool-icon">üíª</span> HTML Viewer</a></li>
                </ul>
            </div>
        </div>
    </div>

    <main class="content tool-page">
        <section class="tool-card">
            <header class="tool-header">
                <h1>üì± Advanced QR Code Generator</h1>
                <p class="tool-desc">Create QR codes and barcodes individually or in bulk from CSV/Excel data. Customize output for print or digital use.</p>
            </header>

            <div class="qr-layout">
                <div class="qr-controls">
                    <!-- Data Input Mode -->
                    <div class="tool-group">
                        <h4>Data Input Mode</h4>
                        <select id="inputMode" class="tool-input">
                            <option value="single">Single Text/URL Input</option>
                            <option value="bulk">Bulk Upload (CSV/Excel)</option>
                        </select>
                    </div>

                    <!-- Single Input Area -->
                    <div id="singleInputSection">
                        <div class="qr-input-container">
                            <textarea id="txt" placeholder="Enter text or URL to generate QR code..." class="tool-input"></textarea>
                        </div>
                    </div>

                    <!-- Bulk Upload Area -->
                    <div id="bulkUploadSection" style="display: none;">
                        <div class="file-upload-options">
                            <input type="file" id="bulkFileInput" accept=".csv" class="tool-input">
                            <div class="drop-hint">Upload CSV file for bulk generation.</div>
                        </div>
                    </div>

                    <!-- Code Type Selection -->
                    <div class="tool-group">
                        <h4>Code Type</h4>
                        <select id="codeType" class="tool-input">
                            <option value="qr">QR Code</option>
                            <option value="barcode">Barcode (Code 128)</option>
                        </select>
                    </div>

                    <!-- Output Options for Bulk Generation -->
                    <div class="tool-group" id="bulkOutputOptions" style="display: none;">
                        <h4>Output Options (Bulk)</h4>
                        <label for="outputFormat">Format:</label>
                        <select id="outputFormat" class="tool-input">
                            <option value="pdf">PDF</option>
                            <option value="png_zip">PNG Images (ZIP)</option>
                        </select>
                        <div class="bulk-controls">
                            <div>
                                <label for="pageSize">Page Size:</label>
                                <select id="pageSize" class="tool-input">
                                    <option value="A4">A4</option>
                                    <option value="Letter">Letter</option>
                                </select>
                            </div>
                            <div>
                                <label for="codesPerPage">Codes per Page:</label>
                                <select id="codesPerPage" class="tool-input">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="4">4</option>
                                    <option value="6">6</option>
                                    <option value="9">9</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- General Customization -->
                    <div class="tool-group">
                        <h4>Code Customization</h4>
                        <label for="codeSize">Code Size (px):</label>
                        <input type="number" id="codeSize" value="256" min="100" class="tool-input">
                        <!-- Add more customizations like color, error level here later -->
                    </div>

                    <button class="btn" id="generateBtn">Generate</button>
                </div>

                <!-- Live Preview and Results Area -->
                <div class="qr-output-area">
                    <h4>Live Preview (First Code)</h4>
                    <div id="qrcode" style="display: inline-block;"></div>
                    <svg id="barcodeSvg" style="display: none;"></svg>

                    <div class="qr-output-actions" id="singleDownloadActions">
                        <button class="btn" id="downloadPngBtn">‚¨áÔ∏è Download PNG</button>
                        <button class="btn" id="printBtn">üñ®Ô∏è Print</button>
                    </div>
                    <div class="qr-output-actions" id="bulkDownloadActions" style="display: none;">
                        <button class="btn" id="bulkDownloadBtn">‚¨áÔ∏è Download Bulk File</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="how-to">
            <h3>How to Use</h3>
            <ol>
                <li>Choose "Single Text/URL Input" to create one QR code at a time. Enter text and see live preview.</li>
                <li>Choose "Bulk Upload (CSV/Excel)" to upload a file containing multiple data entries.</li>
                <li>Select either "QR Code" or "Barcode" as the code type.</li>
                <li>For bulk generation, configure page size and codes per page.</li>
                <li>Click "Generate" to create and download your codes.</li>
            </ol>
        </section>
    </main>

    <!-- PWA Install Button -->
    <div class="pwa-install-container">
        <button class="btn" id="installButton" style="display:none;">Install App</button>
    </div>

    <footer class="main-footer">
        <ul class="footer-links">
            <li><a href="../about.html">About Us</a></li>
            <li><a href="../contact.html">Contact</a></li>
            <li><a href="../blog.html">Blog</a></li>
            <li><a href="../privacy.html">Privacy Policy</a></li>
            <li><a href="../disclaimer.html">Disclaimer</a></li>
        </ul>
        <p class="footer-copyright">&copy; 2025 ToolNine. All Tools Run in Your Browser.</p>
    </footer>

    <!-- Scripts -->
    <script src="../theme.js"></script>
    <!-- Include JSZip for creating ZIP archives (needed for downloading multiple images) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elements ---
            const textInput = document.getElementById('txt');
            const bulkFileInput = document.getElementById('bulkFileInput');
            const codeTypeSelect = document.getElementById('codeType');
            const inputModeSelect = document.getElementById('inputMode');
            const singleInputSection = document.getElementById('singleInputSection');
            const bulkUploadSection = document.getElementById('bulkUploadSection');
            const qrcodeContainer = document.getElementById('qrcode');
            const barcodeSvgContainer = document.getElementById('barcodeSvg');
            const generateBtn = document.getElementById('generateBtn');
            const downloadPngBtn = document.getElementById('downloadPngBtn');
            const bulkDownloadActions = document.getElementById('bulkDownloadActions');
            const bulkDownloadBtn = document.getElementById('bulkDownloadBtn');
            const codesPerPageSelect = document.getElementById('codesPerPage');
            const codeSizeInput = document.getElementById('codeSize');
            const printBtn = document.getElementById('printBtn');
            const bulkOutputOptions = document.getElementById('bulkOutputOptions');

            let lastGeneratedCodes = []; // Store base64 data URLs for bulk download

            // --- UI Visibility Toggles based on Mode Selection ---
            inputModeSelect.addEventListener('change', () => {
                const mode = inputModeSelect.value;
                if (mode === 'single') {
                    singleInputSection.style.display = 'block';
                    bulkUploadSection.style.display = 'none';
                    bulkOutputOptions.style.display = 'none';
                    bulkDownloadActions.style.display = 'none';
                    updateQrCode(); // Show single preview immediately
                } else {
                    singleInputSection.style.display = 'none';
                    bulkUploadSection.style.display = 'block';
                    bulkOutputOptions.style.display = 'block';
                    qrcodeContainer.innerHTML = ''; // Clear preview for bulk mode
                    barcodeSvgContainer.style.display = 'none';
                    downloadPngBtn.style.display = 'none';
                    printBtn.style.display = 'none';
                }
            });

            codeTypeSelect.addEventListener('change', () => {
                if (inputModeSelect.value === 'single') {
                    updateQrCode(); // Re-render preview on code type change
                }
            });

            textInput.addEventListener('input', updateQrCode);
            codeSizeInput.addEventListener('input', updateQrCode);

            // --- Single Code Generation (Live Preview) ---
            function updateQrCode() {
                const codeType = codeTypeSelect.value;
                const text = textInput.value;
                const codeSize = parseInt(codeSizeInput.value) || 256;

                qrcodeContainer.innerHTML = '';
                barcodeSvgContainer.style.display = 'none';

                if (text && codeType === 'qr') {
                    qrcodeContainer.style.display = 'inline-block';
                    new QRCode(qrcodeContainer, {
                        text: text,
                        width: codeSize,
                        height: codeSize,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                } else if (text && codeType === 'barcode') {
                    barcodeSvgContainer.style.display = 'inline-block';
                    // Clear previous barcode content
                    barcodeSvgContainer.innerHTML = '';
                    // Generate new barcode (using JsBarcode library)
                    JsBarcode(barcodeSvgContainer, text, {
                        displayValue: true,
                        width: 2, // Barcode width adjustment
                        height: codeSize / 3, // Adjust height based on total code size input
                        fontSize: 18
                    });
                }

                if (text && inputModeSelect.value === 'single') {
                    downloadPngBtn.style.display = 'inline-block';
                    printBtn.style.display = 'inline-block';
                } else {
                    downloadPngBtn.style.display = 'none';
                    printBtn.style.display = 'none';
                }
            }

            // --- Single Code Download (PNG) ---
            downloadPngBtn.addEventListener('click', () => {
                const codeType = codeTypeSelect.value;
                const codeSize = parseInt(codeSizeInput.value) || 256;
                let dataUrl = '';

                if (codeType === 'qr') {
                    const canvas = qrcodeContainer.querySelector('canvas');
                    dataUrl = canvas.toDataURL("image/png");
                } else if (codeType === 'barcode') {
                    // Get data URL from generated SVG
                    const svgXml = new XMLSerializer().serializeToString(barcodeSvgContainer);
                    const canvas = document.createElement('canvas');
                    canvas.width = codeSize;
                    canvas.height = codeSize; // Adjust height for barcode rendering logic if needed
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    img.onload = () => {
                        ctx.drawImage(img, 0, 0);
                        dataUrl = canvas.toDataURL("image/png");
                        // Trigger download after conversion
                        const link = document.createElement('a');
                        link.href = dataUrl;
                        link.download = `barcode_${codeSize}.png`;
                        link.click();
                    };
                    img.src = 'data:image/svg+xml;base64,' + btoa(svgXml);
                    return; // Return early to prevent default download logic
                }

                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = `code_${codeType}_${codeSize}.png`;
                link.click();
            });

            // --- Bulk Processing Logic (CSV Upload) ---
            generateBtn.addEventListener('click', async () => {
                if (inputModeSelect.value === 'single') {
                    updateQrCode(); // Ensure single mode preview/download is initiated
                    return;
                }

                const file = bulkFileInput.files[0];
                if (!file) {
                    alert('Please upload a CSV file.');
                    return;
                }

                // Parse CSV file content
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const csvData = e.target.result;
                    const parsedData = parseCSV(csvData);

                    // Generate codes for bulk data
                    lastGeneratedCodes = [];
                    const codeType = codeTypeSelect.value;
                    const codeSize = parseInt(codeSizeInput.value) || 256;

                    for (const row of parsedData) {
                        const dataString = row.join(','); // Use entire row data for code generation
                        let codeDataUrl = '';

                        if (codeType === 'qr') {
                            const canvas = await createQrCodeCanvas(dataString, codeSize);
                            codeDataUrl = canvas.toDataURL('image/png');
                        } else if (codeType === 'barcode') {
                            const canvas = await createBarcodeCanvas(dataString, codeSize);
                            codeDataUrl = canvas.toDataURL('image/png');
                        }
                        lastGeneratedCodes.push(codeDataUrl);
                    }

                    // Show bulk download options
                    bulkDownloadActions.style.display = 'flex';
                };
                reader.readAsText(file);
            });

            // Helper function to create QR code canvas from text
            function createQrCodeCanvas(text, size) {
                return new Promise(resolve => {
                    const container = document.createElement('div');
                    new QRCode(container, { text: text, width: size, height: size });
                    // Give QR code time to render
                    setTimeout(() => resolve(container.querySelector('canvas')), 50);
                });
            }

            // Helper function to create barcode canvas from text
            function createBarcodeCanvas(text, size) {
                return new Promise(resolve => {
                    const svg = document.createElement('svg');
                    JsBarcode(svg, text, {
                        displayValue: true,
                        width: 2,
                        height: size / 3,
                        fontSize: 18
                    });

                    // Convert SVG to Canvas (more complex than QR code library's built-in conversion)
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    img.onload = () => {
                        canvas.width = size;
                        canvas.height = size / 3; // Keep aspect ratio consistent
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas);
                    };
                    img.src = 'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(svg));
                });
            }

            // --- Bulk Download Logic ---
            bulkDownloadBtn.addEventListener('click', () => {
                const format = document.getElementById('outputFormat').value;
                if (format === 'pdf') {
                    exportToPDF(lastGeneratedCodes);
                } else if (format === 'png_zip') {
                    exportToZip(lastGeneratedCodes);
                }
            });

            // --- Export to PDF (Bulk) ---
            function exportToPDF(imageUrls) {
                const { jsPDF } = window.jspdf;
                const pageSize = document.getElementById('pageSize').value;
                const codesPerPage = parseInt(codesPerPageSelect.value);
                const doc = new jsPDF('p', 'mm', pageSize);

                const margin = 10;
                const pdfWidth = doc.internal.pageSize.getWidth();
                const pdfHeight = doc.internal.pageSize.getHeight();

                // Calculate layout parameters based on codes per page
                let numCols = 1;
                let numRows = codesPerPage;
                if (codesPerPage === 4) { numCols = 2; numRows = 2; }
                else if (codesPerPage === 6) { numCols = 2; numRows = 3; }
                else if (codesPerPage === 9) { numCols = 3; numRows = 3; }

                const spacingX = (pdfWidth - 2 * margin) / numCols;
                const spacingY = (pdfHeight - 2 * margin) / numRows;

                for (let i = 0; i < imageUrls.length; i++) {
                    const imgData = imageUrls[i];
                    const pageIndex = Math.floor(i / codesPerPage);
                    const itemIndex = i % codesPerPage;
                    const col = itemIndex % numCols;
                    const row = Math.floor(itemIndex / numCols);

                    if (itemIndex === 0 && i > 0) {
                        doc.addPage();
                    }

                    const x = margin + col * spacingX + (spacingX - codeSizeInput.value / 3.78) / 2; // Conversion mm to pixels (approx 3.78 pixels per mm)
                    const y = margin + row * spacingY + (spacingY - codeSizeInput.value / 3.78) / 2;

                    doc.addImage(imgData, 'PNG', x, y, codeSizeInput.value / 3.78, codeSizeInput.value / 3.78);
                }
                doc.save(`bulk_codes.pdf`);
            }

            // --- Export to ZIP (Bulk) ---
            function exportToZip(imageUrls) {
                const zip = new JSZip();
                imageUrls.forEach((dataUrl, index) => {
                    const base64Data = dataUrl.replace(/^data:image\/(png|jpeg);base64,/, "");
                    zip.file(`code_${index + 1}.png`, base64Data, { base64: true });
                });

                zip.generateAsync({ type: "blob" })
                    .then(content => {
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(content);
                        link.download = `bulk_codes.zip`;
                        link.click();
                    });
            }

            // --- Helper function to parse CSV text into data array ---
            function parseCSV(text) {
                const lines = text.split('\n');
                const result = [];
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        result.push(line.split(',')); // Simple split, handle quotes more robustly for production use
                    }
                }
                return result;
            }

            // Initial setup on load
            updateQrCode();
        });
    </script>
</body>
</html>
